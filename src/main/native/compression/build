#!/usr/bin/env bash
IGZIP=isa-l-master
ZLIB=otc_zlib
#ZLIB=zlib-1.2.8
#ZLIB=zlib-inflate
# build igzip library

os=$(uname)
if [[ $os == "Linux" ]]; then

cd $IGZIP
make clean
./autogen.sh
./configure CFLAGS="-fPIC" --prefix=$(pwd)/usr --libdir=$(pwd)/lib
make
make install
cd -

elif [[ $os == "Darwin" ]]; then 

cd $IGZIP
make clean
./autogen.sh
./configure -target=darwin CFLAGS="-fPIC" --prefix=$(pwd)/usr --libdir=$(pwd)/lib
make
make install 
cd - 

else 

echo "OS not supported" 1>&2

fi

#build otc_zlib
cd $ZLIB
make clean
CFLAGS="-O3 -fPIC" ./configure --static
make

cd -

# build GKL shared library
javah -o IntelDeflater.h -cp ../../java com.intel.gkl.compression.IntelDeflater

g++ -c -fPIC -O3 -I$IGZIP/include/ -I$ZLIB \
    -I$JAVA_HOME/include -I$JAVA_HOME/include/linux -I$JAVA_HOME/include/Darwin \
    IntelDeflater.cc

# build GKL shared library
javah -o IntelInflater.h -cp ../../java com.intel.gkl.compression.IntelInflater

g++ -c -fPIC -O3 -I$IGZIP/include/ -I$IGZIP/igzip/ -I$ZLIB \
    -I$JAVA_HOME/include -I$JAVA_HOME/include/linux -I$JAVA_HOME/include/Darwin \
    IntelInflater.cc
